local-asn: 395909

as-set-limit:
  member-limit: 250
  prefix-limit: 50
  large-as-list: []

keepup-as-list: []

blacklist:
  asn:
    - 21158
    - 216056
  as-set:
    - AS216056:AS-VIRTUALIZE
  prefix4:
    - 193.109.132.0/23
  prefix6:
    - 2001:678:de0::/48

template:
  as-path-list:
    - &AUTOGEN-AS-PassGFW
      name: AUTOGEN-AS-PassGFW
      rule:
        - action: permit
          description: Edgecast
          regex: "15133$"
        - action: permit
          description: Fastly
          regex: "54113$"
        - action: permit
          description: Akamai
          regex: "20940$"
        - action: permit
          description: HiNet
          regex: "3462$"
        - action: permit
          description: Google
          regex: "(15169|16550|16591|19527|36040|43515|139070|139190|396982)$"
        - action: permit
          description: Telegram
          regex: "(62014|62041|59930)$"
        - action: permit
          description: Twitter
          regex: "(13414|35995|63179)$"
        - action: permit
          description: Cloudflare
          regex: "13335$"
        - action: permit
          description: IDC Frontier
          regex: "4694$"
        - action: permit
          description: Amazon for docker
          regex: "(14618|16509)$"
        - action: permit
          description: Wikimedia
          regex: "14907$"
        - action: permit
          description: Meta
          regex: "(32934|54115|63293)$"

router:
  - name: edge.pku.395909.atlas.projectk.org
    kernel:
      ipv4:
        - protocol: bgp
          src: 192.168.3.1
      ipv6:
        - protocol: bgp
          src: 2602:f93b:a41:3::1
    policy:
      as-path-list:
        - *AUTOGEN-AS-PassGFW
      # prefix-list:
      #   - name: AUTOGEN-AMPR-IPv4
      #     rule:
      #       - action: permit
      #         prefix: 44.30.63.0/24
    # redistribute:
    #   pre-filter:
    #     - action: permit
    #       match: ip address prefix-list AUTOGEN-AMPR-IPv4
    #       set:
    #         - as-path prepend '203023'
    #         - large-community add '395909:0:500'
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 27523
            extended-nexthop: true
            neighbor-address: wg1241
            update-source: wg1241
          # - asn: 27523
          #   extended-nexthop: true
          #   neighbor-address: wg1221
          #   out-prepend: "395909 395909"
          #   update-source: wg1221
          - asn: 27523
            extended-nexthop: true
            neighbor-address: wg1231
            out-prepend: "395909 395909"
            in-prepend: "395909 395909"
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
            update-source: wg1231
        routeserver: []
        peer: []
        downstream: []

  - name: edge.pkulab.395909.atlas.projectk.org
    kernel:
      ipv4:
        - protocol: bgp
          src: 192.168.4.1
      ipv6:
        - protocol: bgp
          src: 2602:f93b:a41:4::1
    policy:
      as-path-list:
        - *AUTOGEN-AS-PassGFW
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp:
          - neighbor-address: wg1342
            extended-nexthop: true
            update-source: wg1342
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
            pre-export-accept:
              - action: permit
                set: large-community add '395909:0:500'
        upstream:
          # - asn: 27523
          #   extended-nexthop: true
          #   neighbor-address: wg1341
          #   update-source: wg1341
          # - asn: 27523
          #   extended-nexthop: true
          #   neighbor-address: wg1331
          #   out-prepend: "395909 395909"
          #   in-prepend: "395909 395909"
          #   pre-import-accept:
          #     - action: permit
          #       match: as-path AUTOGEN-AS-PassGFW
          #       on-match-next: false
          #     - action: deny
          #   update-source: wg1331
        routeserver: []
        peer: []
        downstream: []

  - name: edge.hkg.395909.atlas.projectk.org
    kernel:
      ipv6:
        - protocol: bgp
          src: 2602:f93b:a21::1
        - protocol: static
          src: 2602:f93b:a21::1
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 53808
            soft-reconfiguration-inbound: false
            neighbor-address: fc00:220::1
            pre-import-accept:
              - action: deny
            update-source: fc00:220::5f:1
        routeserver: []
        peer: []
        downstream: []

  - name: edge.home.395909.atlas.projectk.org
    kernel:
      ipv4:
        - protocol: bgp
          src: 192.168.2.1
      ipv6:
        - protocol: bgp
          src: 2602:f93b:a11::1
    protocols:
      rpki:
        - server: rtr.rpki.cloudflare.com
          port: 8282
          preference: 10
      bgp:
        ibgp: []
        upstream:
          - asn: 27523
            extended-nexthop: true
            neighbor-address: wg1151
            update-source: wg1151
          - asn: 27523
            extended-nexthop: true
            neighbor-address: wg1141
            update-source: wg1141
        routeserver: []
        peer: []
        downstream: []

  - name: edge.tpe.395909.atlas.projectk.org
    kernel:
      ipv4:
        - protocol: bgp
          src: 23.175.25.118
        - protocol: static
          src: 23.175.25.118
      ipv6:
        - protocol: bgp
          src: 2602:f93b:142::1
        - protocol: static
          src: 2602:f93b:142::1
    service:
      sflow:
        agent-address: 2602:f93b:142::1
        interface: [eth0, eth1]
        server:
          - address: 2602:f93b:131:32::200
            port: 6343
          - address: 162.159.65.1
            port: 6343
      snmp:
        listen-address: 2602:f93b:142::1
        location: TPE
        encrypted-password: 3d122fa8c4fc6e28597ecd0331dacde6d71a861b
    policy:
      prefix-list6: []
        # - name: AUTOGEN-BACKBONE-TunnelEndpoint
        #   rule:
        #     - action: permit
        #       prefix: 2602:f93b:f41::/48
      as-path-list:
        - *AUTOGEN-AS-PassGFW
    # redistribute:
    #   pre-accept:
    #     - action: permit
    #       match: ipv6 address prefix-list AUTOGEN-BACKBONE-TunnelEndpoint
    #       set: large-community add 27523:1101:21167
    protocols:
      rpki:
        - server: 172.65.0.2
          port: 8282
          preference: 10
      bgp:
        ibgp:
          - neighbor-address: wg1342
            extended-nexthop: true
            update-source: wg1342
            pre-export-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
        upstream:
          - asn: 44324
            neighbor-address: 23.175.25.1
            soft-reconfiguration-inbound: false
            update-source: eth0
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
          - asn: 44324
            neighbor-address: 2a13:a5c3:3130::1
            soft-reconfiguration-inbound: false
            update-source: eth0
            pre-import-accept:
              - action: permit
                match: as-path AUTOGEN-AS-PassGFW
                on-match-next: false
              - action: deny
        routeserver: []
        peer: []
        downstream: []
